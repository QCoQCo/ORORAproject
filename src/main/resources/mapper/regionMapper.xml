<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.busan.orora.region.mapper.RegionMapper">
    <!-- TODO: 지역 관련 SQL 쿼리 구현 -->

    <!-- 1. 지역 목록 조회 -->
    <select id="searchSpotsByRegion" parameterType="Long" resultType="com.busan.orora.region.dto.SearchSpotsByRegionDto">
        SELECT  ts.id
                , ts.title
                , ts.description
                , tsi.image_url AS imageUrl
                , GROUP_CONCAT(DISTINCT h.name ORDER BY h.name SEPARATOR ', ') AS hashtags
        FROM    tourist_spots ts    JOIN    regions r                   ON ts.region_id = r.id 
                                    JOIN    tourist_spot_images tsi     ON ts.id = tsi.tourist_spot_id
                                    JOIN    tourist_spot_hashtags tsh   ON ts.id = tsh.tourist_spot_id
                                    JOIN    hashtags h                  ON tsh.hashtag_id = h.id
        WHERE   r.id = #{regionId}
        AND     tsi.rep_img_yn = 'Y'
        GROUP BY ts.id,
                 ts.title,
                 ts.description,
                 tsi.image_url
    </select>
    
    <!-- 2. 지역 선택하기(지도에서 지역 중복 선택) -->


</mapper>
